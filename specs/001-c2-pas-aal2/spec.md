# Feature Specification: c2.pas.aal2 - Plone PAS AAL2認証プラグイン

**Feature Branch**: `001-c2-pas-aal2`
**Created**: 2025-11-05
**Status**: Draft
**Input**: User description: "c2.pas.aal2 というパッケージで2ドットのPlone標準的なパッケージ構成にする"

## Clarifications

### Session 2025-11-05

- Q: このタスクで提供する「雛形」の具体的な範囲は何ですか？ → A: Ploneの2ドットパッケージ構造 + PASプラグイン登録の基本的なスケルトン + スタブメソッド（実装なし）
- Q: パッケージ構造に含めるべき追加ファイルの優先度は？ → A: 標準的なPloneパッケージファイル（LICENSE、MANIFEST.in、tox.ini、.gitignore等を追加）
- Q: 雛形段階で提供するテストの具体的な範囲は？ → A: 基本的な構造テスト（インポート + PASプラグイン登録 + スタブメソッド存在確認）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - パッケージ雛形のセットアップと登録 (Priority: P1)

開発者は、将来のAAL2認証機能実装のために、2ドット形式のPloneパッケージ構造を持つ雛形をセットアップし、PASプラグインとして正しく登録できることを確認したい。この雛形には、実際の認証ロジックは含まれず、スタブメソッドとして将来の実装に備える。

**Why this priority**: パッケージの基本構造とPAS統合が正しく動作しなければ、将来の機能実装ができない。プラグインとしての登録と認識が最優先。

**Independent Test**: Plone管理インターフェースでパッケージをインストールし、PASプラグイン一覧に表示されることを確認。プラグインが正しく登録され、エラーなく有効化できることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** Ploneサイトが稼働している、**When** c2.pas.aal2パッケージをインストールする、**Then** PASプラグイン一覧にAAL2プラグインが表示される
2. **Given** AAL2プラグイン雛形がインストール済み、**When** プラグインを有効化する、**Then** エラーなく有効化され、既存の認証フローに影響を与えない
3. **Given** AAL2プラグイン雛形が有効、**When** ユーザーがログインを試みる、**Then** スタブメソッドが呼ばれるが、実際の処理は行わず従来の認証フローが継続される

---

### User Story 2 - 基本的なテスト構造の提供 (Priority: P2)

開発者は、将来の機能実装時にテストを追加しやすくするため、Pytestを使用した基本的なテスト構造とサンプルテストを含む雛形を準備したい。

**Why this priority**: テスト構造が事前に整備されていれば、将来の開発者がテストを追加しやすくなる。パッケージ構造に次いで重要。

**Independent Test**: pytestを実行して、サンプルテスト（パッケージのインポート、基本的な構造確認など）が成功することを確認。

**Acceptance Scenarios**:

1. **Given** パッケージがインストール済み、**When** pytestを実行する、**Then** 基本的なテストが成功する（少なくとも1つのテストがパスする）
2. **Given** テストディレクトリが存在する、**When** テスト構造を確認する、**Then** 標準的なPytestディレクトリ構造（tests/ディレクトリ、conftest.py等）が整っている
3. **Given** テスト雛形が提供されている、**When** 新しいテストを追加する、**Then** 既存の構造を参考に容易に追加できる

---

### User Story 3 - ドキュメントと設定ファイルの雛形 (Priority: P3)

開発者は、パッケージの目的、構造、将来の実装ガイドラインを理解するため、基本的なドキュメント（README、setup.py/pyproject.toml、ZCML設定ファイル等）を含む雛形を準備したい。

**Why this priority**: ドキュメントは将来の開発に役立つが、パッケージの基本動作には直接影響しない。優先度は低いが、将来のメンテナンス性向上のために重要。

**Independent Test**: README.mdが存在し、パッケージのインストール方法と基本構造が記載されていることを確認。setup.pyまたはpyproject.tomlが適切な依存関係を定義していることを確認。

**Acceptance Scenarios**:

1. **Given** パッケージディレクトリが存在する、**When** README.mdを開く、**Then** パッケージの目的、インストール方法、基本構造が記載されている
2. **Given** パッケージがインストールされる、**When** setup.pyまたはpyproject.tomlを確認する、**Then** 適切な依存関係（Plone、Python 3.11+）が定義されている
3. **Given** ZCML設定ファイルが存在する、**When** PASプラグイン登録を確認する、**Then** 正しいインターフェースとクラスが登録されている

---

### Edge Cases

- パッケージインストール時にPloneのバージョンが5.2未満の場合、適切なエラーメッセージが表示されるか？
- Python 3.10以下の環境でインストールを試みた場合、適切に失敗するか？
- PASプラグイン雛形が有効化されているが、スタブメソッドが呼ばれた場合、既存の認証フローを妨げないか？
- パッケージをアンインストールした場合、Ploneサイトに残留ファイルや設定が残らないか？
- 2ドット形式のパッケージ構造が正しくインストールされ、Python importパスが期待通りに動作するか？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: パッケージは2ドット形式（`c2.pas.aal2`）のPlone標準パッケージ構造を持たなければならない
- **FR-002**: パッケージはPlone.PASのプラグインとして登録可能な雛形構造を含まなければならない
- **FR-003**: PASプラグインインターフェースを実装したスタブクラスを含まなければならない（実際の認証ロジックは含まない）
- **FR-004**: パッケージはPython 3.11以上で動作しなければならない
- **FR-005**: パッケージはPlone 5.2以上との互換性を持たなければならない
- **FR-006**: Pytestを使用した基本的なテスト構造とサンプルテストを含まなければならない（パッケージインポートテスト、PASプラグイン登録テスト、スタブメソッド存在確認テスト）
- **FR-007**: 適切なsetup.pyまたはpyproject.tomlファイルを含み、依存関係を定義しなければならない
- **FR-008**: ZCML設定ファイルを含み、PASプラグインとしての登録設定を記述しなければならない
- **FR-009**: README.mdを含み、パッケージの目的、構造、将来の実装ガイドラインを記載しなければならない
- **FR-010**: プラグイン雛形の有効化・無効化は既存の認証フローに悪影響を与えてはならない（スタブメソッドは何もせず戻る）
- **FR-011**: 標準的なPloneパッケージファイルを含まなければならない（LICENSE、MANIFEST.in、.gitignore、tox.ini等）
- **FR-012**: LICENSEファイルは適切なオープンソースライセンス（GPLv2またはMIT等）を指定しなければならない

### Key Entities

- **AAL2Plugin**: PASプラグインのスタブクラス。将来的にAAL2認証検証を実装するための雛形。現時点では必要なインターフェースメソッドをスタブとして持つ
- **PackageStructure**: 2ドット形式（`c2.pas.aal2`）のディレクトリ構造。`c2/pas/aal2/` の階層を持ち、各レベルに適切な `__init__.py` を含む
- **TestSuite**: Pytestベースのテスト構造。基本的なインポートテスト、プラグイン登録テスト等のサンプルを含む

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 開発者がc2.pas.aal2パッケージ雛形を5分以内にインストールできる
- **SC-002**: インストール後、PASプラグイン一覧にAAL2プラグインが表示される
- **SC-003**: プラグイン雛形を有効化しても、既存の認証フローに一切影響を与えない（ゼロダウンタイム、エラーなし）
- **SC-004**: `import c2.pas.aal2` が成功し、パッケージ構造が正しくインポート可能
- **SC-005**: 提供されたサンプルPytestテストが100%成功する（少なくとも3つのテストケース：インポートテスト、プラグイン登録テスト、スタブメソッド存在確認テスト）
- **SC-006**: README.mdに記載されたインストール手順に従って、開発者が10分以内にセットアップ完了できる

## Assumptions

- Ploneのバージョンは5.2以上を想定（Plone.PASが適切に動作する環境）
- このタスクではパッケージの雛形のみを提供し、実際のAAL2認証ロジックは将来のイテレーションで実装される
- PASプラグインインターフェースの基本的な理解があることを前提とする（必要なメソッドをスタブとして実装）
- パッケージはPlone内部での使用を想定しており、独立した環境構築は不要
- テスト実行は外部CI/CD環境で行われるため、本パッケージにはテスト実行のための特別なセットアップスクリプトは含まれない
- 開発者は将来的にスタブメソッドを実装する際に、このパッケージ構造を基盤として使用する

## Out of Scope

- 実際のAAL2認証検証ロジックの実装（スタブのみ提供、将来実装予定）
- 具体的な多要素認証方式（TOTP、SMS、WebAuthnなど）の実装または統合
- AAL2ポリシー設定機能の実装（将来実装予定）
- 認証イベントのログ記録機能の実装（将来実装予定）
- 管理画面UIの実装（設定画面、ログビューアなど）
- AAL3以上の認証レベル対応
- Plone以外のCMSやフレームワークへの対応
- リアルタイム通知システム（認証失敗時のアラートなど）

## Dependencies

- Plone 5.2以上のインストール済み環境
- Plone.PASパッケージ（Ploneコアに含まれる）
- Python 3.11以上のランタイム環境
- pytest及び関連テストライブラリ（開発依存関係として定義）
- setuptools または pip（パッケージインストール用）
