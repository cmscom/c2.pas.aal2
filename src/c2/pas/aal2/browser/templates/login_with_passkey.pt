<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="c2.pas.aal2">

<body>
  <metal:content-core fill-slot="content-core">
    <metal:block define-macro="content-core">

      <h1 class="documentFirstHeading" i18n:translate="">Sign in with Passkey</h1>

      <div class="documentDescription" i18n:translate="">
        Use your passkey (biometric sensor or security key) to sign in securely without a password.
      </div>

      <div id="passkey-login-info" class="portalMessage info" style="display: none;">
        <strong i18n:translate="">Touch your security key or use your device's biometric sensor</strong>
      </div>

      <div id="passkey-error" class="portalMessage error" style="display: none;"></div>
      <div id="passkey-success" class="portalMessage info" style="display: none;"></div>

      <form id="login-passkey-form" method="post">
        <div class="field">
          <label for="username" i18n:translate="">Username or Email (Optional)</label>
          <div class="formHelp" i18n:translate="">
            Enter your username to filter available passkeys, or leave blank to use any registered passkey
          </div>
          <input type="text"
                 id="username"
                 name="username"
                 class="form-control"
                 placeholder="username"
                 i18n:attributes="placeholder" />
        </div>

        <div class="formControls">
          <button type="button"
                  id="login-button"
                  class="btn btn-primary"
                  i18n:translate="">
            Sign in with Passkey
          </button>
          <a tal:attributes="href string:${context/portal_url}/login"
             class="btn btn-secondary"
             i18n:translate="">
            Use Password Instead
          </a>
        </div>
      </form>

      <div id="browser-support-warning" class="portalMessage warning" style="display: none;">
        <strong i18n:translate="">WebAuthn Not Supported</strong>
        <p i18n:translate="">
          Your browser does not support WebAuthn (passkey authentication).
          Please <a href="#" onclick="document.getElementById('login-button').nextElementSibling.click(); return false;">use password login</a>
          or use a modern browser like Chrome, Firefox, Safari, or Edge.
        </p>
      </div>

    </metal:block>
  </metal:content-core>

  <metal:javascript fill-slot="javascript_head_slot">
    <!-- Load WebAuthn JavaScript modules -->
    <script tal:attributes="src string:${context/portal_url}/++resource++c2.pas.aal2/js/webauthn-utils.js"></script>
    <script tal:attributes="src string:${context/portal_url}/++resource++c2.pas.aal2/js/webauthn-login.js"></script>

    <!-- Initialize passkey login -->
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function() {
        initPasskeyLogin({
          usernameInputId: 'username',
          loginButtonId: 'login-button',
          autoFillUsername: true
        });
      });
    </script>
  </metal:javascript>

</body>
</html>
