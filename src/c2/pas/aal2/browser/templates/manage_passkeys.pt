<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="c2.pas.aal2">

<body>
  <metal:content-core fill-slot="content-core">
    <metal:block define-macro="content-core">

      <h1 class="documentFirstHeading" i18n:translate="">Manage Your Passkeys</h1>

      <div class="documentDescription" i18n:translate="">
        View and manage your registered passkeys. You can rename or remove passkeys from this page.
      </div>

      <div id="passkey-error" class="portalMessage error" style="display: none;"></div>
      <div id="passkey-success" class="portalMessage info" style="display: none;"></div>

      <div class="formControls" style="margin-bottom: 1em;">
        <a tal:attributes="href string:${context/portal_url}/@@passkey-register-form"
           class="btn btn-primary"
           i18n:translate="">
          Add New Passkey
        </a>
      </div>

      <div id="passkey-loading" style="display: none;">
        <p i18n:translate="">Loading passkeys...</p>
      </div>

      <div id="passkey-list-container">
        <!-- Passkeys will be loaded here via JavaScript -->
      </div>

      <div id="no-passkeys" style="display: none;" class="portalMessage info">
        <strong i18n:translate="">No passkeys registered</strong>
        <p i18n:translate="">
          You haven't registered any passkeys yet.
          <a href="#" onclick="window.location.href='@@passkey-register-form'; return false;">Add your first passkey</a>
          to enable passwordless login.
        </p>
      </div>

    </metal:block>
  </metal:content-core>

  <metal:javascript fill-slot="javascript_head_slot">
    <!-- Load WebAuthn JavaScript modules -->
    <script tal:attributes="src string:${context/portal_url}/++resource++c2.pas.aal2/js/webauthn-utils.js"></script>
    <script tal:attributes="src string:${context/portal_url}/++resource++c2.pas.aal2/js/passkey-management.js"></script>

    <!-- Initialize passkey management -->
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function() {
        initPasskeyManagement();
      });
    </script>
  </metal:javascript>

</body>
</html>
