<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="c2.pas.aal2">

<body>
  <metal:content-core fill-slot="content-core">
    <metal:block define-macro="content-core">

      <h1 class="documentFirstHeading" i18n:translate="">Register a Passkey</h1>

      <div class="documentDescription" i18n:translate="">
        Add a passkey to your account for passwordless authentication. You can use your device's
        biometric sensor (fingerprint, face recognition) or a security key.
      </div>

      <div id="passkey-register-form" class="portalMessage info" style="display: none;">
        <strong i18n:translate="">Touch your security key or use your device's biometric sensor</strong>
      </div>

      <div id="passkey-error" class="portalMessage error" style="display: none;"></div>
      <div id="passkey-success" class="portalMessage info" style="display: none;"></div>

      <form id="register-passkey-form" method="post">
        <div class="field">
          <label for="device-name" i18n:translate="">Device Name (Optional)</label>
          <div class="formHelp" i18n:translate="">
            Give this passkey a friendly name (e.g., "My iPhone", "YubiKey 5")
          </div>
          <input type="text"
                 id="device-name"
                 name="device_name"
                 class="form-control"
                 maxlength="100"
                 placeholder="My Device"
                 i18n:attributes="placeholder" />
        </div>

        <div class="field">
          <label for="authenticator-type" i18n:translate="">Authenticator Type</label>
          <div class="formHelp" i18n:translate="">
            Choose the type of authenticator you want to use
          </div>
          <select id="authenticator-type" name="authenticator_attachment" class="form-control">
            <option value="" i18n:translate="">Any (Platform or Security Key)</option>
            <option value="platform" i18n:translate="">Platform (This Device)</option>
            <option value="cross-platform" i18n:translate="">Cross-Platform (Security Key)</option>
          </select>
        </div>

        <div class="formControls">
          <button type="button"
                  id="register-button"
                  class="btn btn-primary"
                  i18n:translate="">
            Register Passkey
          </button>
          <a tal:attributes="href python:context.absolute_url() + '/@@personal-information'"
             class="btn btn-secondary"
             i18n:translate="">
            Cancel
          </a>
        </div>
      </form>

      <div id="browser-support-warning" class="portalMessage warning" style="display: none;">
        <strong i18n:translate="">WebAuthn Not Supported</strong>
        <p i18n:translate="">
          Your browser does not support WebAuthn (passkey authentication).
          Please use a modern browser like Chrome, Firefox, Safari, or Edge.
        </p>
      </div>

    </metal:block>
  </metal:content-core>

  <metal:javascript fill-slot="javascript_head_slot">
    <!-- Load WebAuthn JavaScript modules -->
    <script tal:attributes="src string:${context/portal_url}/++resource++c2.pas.aal2/js/webauthn-utils.js"></script>
    <script tal:attributes="src string:${context/portal_url}/++resource++c2.pas.aal2/js/webauthn-register.js"></script>

    <!-- Initialize passkey registration -->
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function() {
        initPasskeyRegistration();
      });
    </script>
  </metal:javascript>

</body>
</html>
