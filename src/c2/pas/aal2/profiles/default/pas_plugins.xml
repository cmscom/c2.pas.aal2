<?xml version="1.0" encoding="UTF-8"?>
<pluggable-auth-service>
  <plugins>
    <plugin
        id="aal2_plugin"
        type_name="C2 PAS AAL2 Plugin"
        meta_type="C2 PAS AAL2 Plugin"
        />
  </plugins>

  <!-- Activate the plugin for implemented interfaces -->
  <!-- Note: We don't implement ICredentialsUpdatePlugin - let standard Plone handle cookies -->
  <plugin-interfaces>
    <plugin-interface
        id="aal2_plugin"
        interface="Products.PluggableAuthService.interfaces.plugins.IExtractionPlugin"
        />
    <plugin-interface
        id="aal2_plugin"
        interface="Products.PluggableAuthService.interfaces.plugins.IAuthenticationPlugin"
        />
    <plugin-interface
        id="aal2_plugin"
        interface="Products.PluggableAuthService.interfaces.plugins.IValidationPlugin"
        />
  </plugin-interfaces>

  <!-- Set plugin order -->
  <!-- AAL2 plugin should run after standard cookie auth for extraction -->
  <!-- but with high priority for authentication and validation -->
  <plugin-order>
    <extraction>
      <!-- Let cookie auth extract first, then AAL2 for passkey markers -->
      <plugin id="aal2_plugin" pos="5"/>
    </extraction>
    <authentication>
      <!-- High priority for passkey authentication -->
      <plugin id="aal2_plugin" pos="0"/>
    </authentication>
    <validation>
      <!-- High priority for AAL2 validation -->
      <plugin id="aal2_plugin" pos="0"/>
    </validation>
    <!-- No credentialsupdater - we delegate to standard Plone -->
  </plugin-order>
</pluggable-auth-service>
